database : springdb
username : springuser
pw : mysql

-- 1. 데이터베이스 생성 (이름: springdb)
CREATE DATABASE IF NOT EXISTS springdb DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 2. 사용자 생성 (아이디: springuser, 비밀번호: mysql)
-- 'localhost'는 DB와 웹 서버가 같은 컴퓨터에 있을 때 사용합니다.
CREATE USER IF NOT EXISTS 'springuser'@'localhost' IDENTIFIED BY 'mysql';

GRANT ALL PRIVILEGES ON springdb.* TO 'springuser'@'localhost';

FLUSH PRIVILEGES;

CREATE TABLE IF NOT EXISTS board (
    bno INT NOT NULL AUTO_INCREMENT COMMENT '게시글 번호(PK)',
    title VARCHAR(200) NOT NULL COMMENT '제목',
    content TEXT COMMENT '내용',
    writer VARCHAR(50) NOT NULL COMMENT '작성자',
    read_count INT DEFAULT 0 COMMENT '조회수',
    is_del CHAR(1) DEFAULT 'N' COMMENT '삭제여부(Y/N)',
    reg_date DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '작성일',
    PRIMARY KEY (bno)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;


-- 회원 테이블 생성
CREATE TABLE IF NOT EXISTS member (
    id VARCHAR(50) NOT NULL COMMENT '아이디',
    pw VARCHAR(100) NOT NULL COMMENT '비밀번호',
    name VARCHAR(50) NOT NULL COMMENT '이름',
    reg_date DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '가입일',
    PRIMARY KEY (id)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 테스트용 계정 추가 (아이디: admin / 비번: 1234)
INSERT INTO member (id, pw, name) VALUES ('admin', '1234', '관리자');

CREATE TABLE IF NOT EXISTS reply (
    rno INT AUTO_INCREMENT PRIMARY KEY,
    bno INT NOT NULL,
    reply VARCHAR(1000) NOT NULL,
    replyer VARCHAR(50) NOT NULL,
    replyDate DATETIME DEFAULT CURRENT_TIMESTAMP,
    updateDate DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (bno) REFERENCES board(bno) ON DELETE CASCADE
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 조회수 중복 방지 로그 테이블
CREATE TABLE IF NOT EXISTS board_read_log (
    log_no INT AUTO_INCREMENT PRIMARY KEY,
    bno INT NOT NULL,
    reader_id VARCHAR(50) NOT NULL,
    read_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (bno) REFERENCES board(bno) ON DELETE CASCADE,
    UNIQUE KEY unique_read (bno, reader_id)  -- 중요: (글번호, 아이디) 조합은 유일해야 함
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

DELIMITER $$
CREATE PROCEDURE insertLoop()
BEGIN
    DECLARE i INT DEFAULT 1;
    WHILE i <= 100 DO
        INSERT INTO board(title, content, writer)
        VALUES (concat('테스트 제목 ', i), concat('테스트 내용 ', i), concat('user', i % 10));
        SET i = i + 1;
    END WHILE;
END$$
DELIMITER ;

CALL insertLoop();
DROP PROCEDURE insertLoop;










